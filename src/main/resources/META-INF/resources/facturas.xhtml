<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gestión de Facturas</title>
</h:head>

<h:body>
    <h:form id="form-facturas">
        <div class="card">
            <p:growl id="msgFacturas" showDetail="true" />

            <p:menubar>
                <p:menuitem value="Nueva factura" icon="pi pi-file"
                            actionListener="#{facturaBean.prepararNuevo}"
                            update=":form-modal:panelFactura"
                            oncomplete="PF('dlgFactura').show()" />
            </p:menubar>

            <p:dataTable value="#{facturaBean.facturas}" var="f" id="tabla-facturas"
                         paginator="true" rows="5" responsiveLayout="scroll">

                <f:facet name="header">
                    <h3>Gestión de Facturas</h3>
                </f:facet>

                <p:column headerText="Código" sortBy="#{f.codigo}">
                    <h:outputText value="#{f.codigo}" />
                </p:column>

                <p:column headerText="Cliente ID">
                    <h:outputText value="#{f.cliente_id}" />
                </p:column>

                <p:column headerText="Empleado ID">
                    <h:outputText value="#{f.empleado_id}" />
                </p:column>

                <p:column headerText="Fecha">
                    <h:outputText value="#{f.fecha}" />
                </p:column>

                <p:column headerText="Total">
                    <h:outputText value="#{f.total}" />
                </p:column>

                <p:column headerText="Acciones">
                    <p:commandButton value="Editar" icon="pi pi-pencil"
                                     actionListener="#{facturaBean.prepararEdicion(f)}"
                                     update=":form-modal:panelFactura"
                                     oncomplete="PF('dlgFactura').show()" />
                    <p:commandButton value="Eliminar" icon="pi pi-trash" class="ui-button-danger"
                                     action="#{facturaBean.eliminarFactura(f.codigo)}"
                                     update=":form-facturas:tabla-facturas :form-facturas:msgFacturas" />
                </p:column>
            </p:dataTable>
        </div>
    </h:form>

    <!-- Modal Factura -->
    <h:form id="form-modal">
        <p:dialog header="Detalle de la Factura" widgetVar="dlgFactura" modal="true" responsive="true">
            <p:outputPanel id="panelFactura" class="ui-fluid">

                <div class="field">
                    <p:outputLabel for="cliente" value="Cliente ID:" />
                    <p:inputText id="cliente" value="#{facturaBean.facturaActual.cliente_id}" />
                </div>

                <div class="field">
                    <p:outputLabel for="empleado" value="Empleado ID:" />
                    <p:inputText id="empleado" value="#{facturaBean.facturaActual.empleado_id}" />
                </div>

                <div class="field">
                    <p:outputLabel for="fecha" value="Fecha:" />
                    <p:calendar id="fecha" value="#{facturaBean.facturaActual.fecha}" pattern="dd/MM/yyyy"/>
                </div>

                <div class="field">
                    <p:outputLabel for="total" value="Total:" />
                    <p:inputText id="total" value="#{facturaBean.facturaActual.total}" />
                </div>

            </p:outputPanel>

            <f:facet name="footer">
                <p:commandButton value="Guardar" icon="pi pi-check"
                                 actionListener="#{facturaBean.guardarFactura}"
                                 update=":form-facturas:tabla-facturas :form-facturas:msgFacturas"
                                 oncomplete="PF('dlgFactura').hide()" />
                <p:commandButton value="Cancelar" icon="pi pi-times"
                                 onclick="PF('dlgFactura').hide()" type="button" />
            </f:facet>
        </p:dialog>
    </h:form>
</h:body>
</html>
