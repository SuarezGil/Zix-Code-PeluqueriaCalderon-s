<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Gestión de Clientes</title>
</h:head>

<h:body>
    <h:form id="formClientes">
        <h2>Clientes</h2>

        <!-- Barra de búsqueda -->
        <p:panel>
            <h:outputLabel for="txtBuscar" value="Buscar por código:"/>
            <p:inputText id="txtBuscar" value="#{clienteBean.textoBusqueda}" placeholder="Ingrese código"/>
            <p:commandButton value="Buscar" action="#{clienteBean.buscarClientePorId}"
                             update="tablaClientes messages"/>
        </p:panel>

        <p:messages id="messages" autoUpdate="true" showDetail="true" />

        <!-- Tabla de clientes -->
        <p:dataTable id="tablaClientes" var="c" value="#{clienteBean.clientes}"
                     selectionMode="single" selection="#{clienteBean.clienteSeleccionado}"
                     rowKey="#{c.codigoCliente}" paginator="true" rows="10">

            <p:column headerText="Código">
                <h:outputText value="#{c.codigoCliente}" />
            </p:column>

            <p:column headerText="Nombre">
                <h:outputText value="#{c.name}" />
            </p:column>

            <p:column headerText="Teléfono">
                <h:outputText value="#{c.tel}" />
            </p:column>

            <p:column headerText="Email">
                <h:outputText value="#{c.email}" />
            </p:column>

            <p:column headerText="Fecha Registro">
                <h:outputText value="#{c.registrationDate}">
                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                </h:outputText>
            </p:column>

            <p:column headerText="Acciones">
                <p:commandButton value="Editar" icon="pi pi-pencil"
                                 actionListener="#{clienteBean.seleccionarCliente(c)}"
                                 update=":formClientes:dlgEditar"
                                 oncomplete="PF('dlgEditar').show()"/>

                <p:commandButton value="Eliminar" icon="pi pi-trash"
                                 actionListener="#{clienteBean.seleccionarCliente(c)}"
                                 update=":formClientes:dlgEliminar"
                                 oncomplete="PF('dlgEliminar').show()"/>
            </p:column>
        </p:dataTable>

        <!-- Dialogo de edición -->
        <p:dialog id="dlgEditar" widgetVar="dlgEditar" header="Editar Cliente" modal="true" resizable="false">
            <h:panelGrid columns="2" cellpadding="5">
                <h:outputLabel for="editNombre" value="Nombre:"/>
                <p:inputText id="editNombre" value="#{clienteBean.clienteSeleccionado.name}" required="true"/>

                <h:outputLabel for="editTel" value="Teléfono:"/>
                <p:inputText id="editTel" value="#{clienteBean.clienteSeleccionado.tel}" required="true"/>

                <h:outputLabel for="editEmail" value="Email:"/>
                <p:inputText id="editEmail" value="#{clienteBean.clienteSeleccionado.email}" required="true"/>

                <h:outputLabel for="editFecha" value="Fecha Registro:"/>
                <p:calendar id="editFecha" value="#{clienteBean.clienteSeleccionado.registrationDate}"
                            pattern="yyyy-MM-dd" required="true"/>
            </h:panelGrid>

            <p:commandButton value="Guardar" action="#{clienteBean.modificarCliente}"
                             update=":formClientes:tablaClientes :formClientes:messages"
                             oncomplete="PF('dlgEditar').hide()"/>
            <p:commandButton value="Cancelar" onclick="PF('dlgEditar').hide()" type="button"/>
        </p:dialog>

        <!-- Dialogo de eliminación -->
        <p:dialog id="dlgEliminar" widgetVar="dlgEliminar" header="Confirmar Eliminación" modal="true" resizable="false">
            <h:outputText value="¿Está seguro de eliminar al cliente #{clienteBean.clienteSeleccionado.name}?" />
            <p:commandButton value="Sí" action="#{clienteBean.eliminarCliente}"
                             update=":formClientes:tablaClientes :formClientes:messages"
                             oncomplete="PF('dlgEliminar').hide()"/>
            <p:commandButton value="No" onclick="PF('dlgEliminar').hide()" type="button"/>
        </p:dialog>

        <!-- Formulario para agregar cliente nuevo -->
        <h3>Agregar Cliente Nuevo</h3>
        <h:panelGrid columns="2" cellpadding="5">
            <h:outputLabel for="nuevoNombre" value="Nombre:"/>
            <p:inputText id="nuevoNombre" value="#{clienteBean.clienteNuevo.name}" required="true"/>

            <h:outputLabel for="nuevoTel" value="Teléfono:"/>
            <p:inputText id="nuevoTel" value="#{clienteBean.clienteNuevo.tel}" required="true"/>

            <h:outputLabel for="nuevoEmail" value="Email:"/>
            <p:inputText id="nuevoEmail" value="#{clienteBean.clienteNuevo.email}" required="true"/>

            <h:outputLabel for="nuevoFecha" value="Fecha Registro:"/>
            <p:calendar id="nuevoFecha" value="#{clienteBean.clienteNuevo.registrationDate}" pattern="yyyy-MM-dd" required="true"/>
        </h:panelGrid>

        <p:commandButton value="Guardar Cliente" action="#{clienteBean.guardarCliente}"
                         update=":formClientes:tablaClientes :formClientes:messages"/>
    </h:form>
</h:body>
</html>
